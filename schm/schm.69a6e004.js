var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},n={},r=e.parcelRequireed82;null==r&&((r=function(e){if(e in t)return t[e].exports;if(e in n){var r=n[e];delete n[e];var i={id:e,exports:{}};return t[e]=i,r.call(i.exports,i,i.exports),i.exports}var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){n[e]=t},e.parcelRequireed82=r);var i=r("jzg1d"),o=r("83zT6"),s=r("2h9ct"),a=r("lW3AJ"),l=r("inIMS"),c=r("bmHVE"),u=r("5ndKB"),d=r("lrKvI"),f=r("c3RIb"),p=r("cJntk"),g=r("4iSHH");const m=[227,6,19],h=[...m,.6],w=`\n<svg xmlns="http://www.w3.org/2000/svg" width="20" height="33">\n  <path d="M10 0C5 0 .5 3 .5 9c0 4 9.5 24 9.5 24s9.5-20 9.5-24c0-6-4.5-9-9.5-9z" fill="${(0,g.toString)(m)}"/>\n</svg>\n`,y=new(0,f.default)({image:new(0,u.default)({fill:new(0,l.default)({color:h}),stroke:new(0,d.default)({width:2,color:m}),points:4,radius:8,angle:Math.PI/4}),text:new(0,p.default)({fill:new(0,l.default)({color:"#fff"})})}),x=y.clone(),v=y.clone(),S=y.clone();S.getText().setText("A");const T=y.clone();T.getText().setText("B");const _=new(0,f.default)({zIndex:100,image:new(0,c.default)({src:`data:image/svg+xml;utf8,${w}`})}),k={POI:new(0,f.default)({text:new(0,p.default)({font:"20px sans-serif",offsetX:20,textAlign:"left",backgroundFill:new(0,l.default)({color:"#ffffffaa"}),text:"drag to move POI"})}),cp:new(0,f.default)({text:new(0,p.default)({font:"20px sans-serif",offsetX:20,textAlign:"left",backgroundFill:new(0,l.default)({color:"#ffffffaa"}),text:"click to delete\ndrag to move point"})}),segment:new(0,f.default)({text:new(0,p.default)({backgroundFill:new(0,l.default)({color:"#ffffffaa"}),offsetX:20,textAlign:"left",font:"20px sans-serif",text:"drag to create point"})})},b=new(0,f.default)({stroke:new(0,d.default)({color:m,width:6})}),E=b.clone();function P(e,t){const n=e.get("type"),r=e.get("subtype"),i=e.get("index");switch(n){case"sketch":return r?[x,k[r]]:x;case"POI":return _;case"controlPoint":switch(r){case"first":return S;case"last":return T;default:return void 0!==i?(v.getText().setText((i+1).toString()),v):y}case"segment":return"modifying"===r?E:b;default:return null}}E.getStroke().setColor(h),E.getStroke().setLineDash([1,12]);var j=r("wnhPR"),F=(l=r("inIMS"),f=r("c3RIb"),r("71uyY"));function I(e,t){const n=[];Object.keys(t).forEach((function(e){null!==t[e]&&void 0!==t[e]&&n.push(e+"="+encodeURIComponent(t[e]))}));const r=n.join("&");return e=e.replace(/[?&]$/,""),(e+=e.includes("?")?"&":"?")+r}r("9pD6L");var L=r("g5oyO");r("dpRHA");class q extends L.default{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}}var C=q;var R=r("cwqvp");r("dpRHA");class O extends F.default{constructor(e){const t=void 0!==e.requestEncoding?e.requestEncoding:"KVP",n=e.tileGrid;let r=e.urls;void 0===r&&void 0!==e.url&&(r=(0,R.expandUrl)(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:n,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:r,wrapX:void 0!==e.wrapX&&e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.version_=void 0!==e.version?e.version:"1.0.0",this.format_=void 0!==e.format?e.format:"image/jpeg",this.dimensions_=void 0!==e.dimensions?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=t,this.setKey(this.getKeyForDimensions_()),r&&r.length>0&&(this.tileUrlFunction=(0,R.createFromTileUrlFunctions)(r.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const t=e.join("\n");this.setTileUrlFunction((0,R.createFromTileUrlFunctions)(e.map(this.createFromWMTSTemplate.bind(this))),t)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const t in this.dimensions_)e.push(t+"-"+this.dimensions_[t]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const t=this.requestEncoding_,n={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};"KVP"==t&&Object.assign(n,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e="KVP"==t?I(e,n):e.replace(/\{(\w+?)\}/g,(function(e,t){return t.toLowerCase()in n?n[t.toLowerCase()]:e}));const r=this.tileGrid,i=this.dimensions_;return function(n,o,s){if(!n)return;const a={TileMatrix:r.getMatrixId(n[0]),TileCol:n[1],TileRow:n[2]};Object.assign(a,i);let l=e;return l="KVP"==t?I(l,a):l.replace(/\{(\w+?)\}/g,(function(e,t){return a[t]})),l}}}var z=O;const M=[4e3,3750,3500,3250,3e3,2750,2500,2250,2e3,1750,1500,1250,1e3,750,650,500,250,100,50,20,10,5,2.5,2,1.5,1,.5,.25,.1],D=function(e){console.assert(e<M.length);const t=new Array(e);for(let n=0;n<=e;++n)t[n]=String(n);return t},G={"EPSG:2056":[242e4,103e4,29e5,135e4],"EPSG:21781":[42e4,3e4,9e5,35e4]};function K(e,t,n){if(e.includes("{Layer}"))return e;let r=`${e}/1.0.0/{Layer}/default/{Time}`;if("EPSG:2056"===t)r+=`/2056/{TileMatrix}/{TileCol}/{TileRow}.${n}`;else{if("EPSG:21781"!==t)throw new Error(`Unsupported projection ${t}`);r+=`/21781/{TileMatrix}/{TileRow}/{TileCol}.${n}`}return r}class U extends z{constructor(e){const t=e.format||"image/png",n=e.projection;console.assert("EPSG:21781"===n||"EPSG:2056"===n);const r=function(e,t){return new C({extent:G[e],resolutions:M.slice(0,t+1),matrixIds:D(t)})}(n,e.level||27),i=n.split(":")[1],o=t.split("/")[1];console.assert(!!i),console.assert(!!o),super({attributions:e.attributions||'&copy; <a href="https://www.swisstopo.admin.ch">swisstopo</a>',url:K(e.baseUrl||"https://wmts{0-9}.geo.admin.ch",n,o),dimensions:{Time:e.timestamp||"current"},projection:n,requestEncoding:"REST",layer:e.layer,style:"default",matrixSet:i,format:t,tileGrid:r,crossOrigin:e.crossOrigin||"anonymous"}),this.projectionCode_=n}getProjectionExtent(){return G[this.projectionCode_]}}var A=r("9A3Ac"),$=r("4mWlF"),H=r("bdrRp"),V=r("bnthu"),X=r("5DwXE"),W=r("9DiKA");d=r("lrKvI"),f=r("c3RIb"),V=r("bnthu"),H=r("bdrRp");const J=new(0,f.default)({stroke:new(0,d.default)({color:"#00cc33aa",width:6})});function N(){const e=new(0,V.default);return new(0,H.default)({source:e,style:J})}const B=[650,500,250,100,50,20,10,5,2.5,2,1.5,1];function Y(e){const t=new(0,V.default),n=new(0,H.default)({source:t,style:P}),r=A.proj.getExtent(),i=new(0,W.default)({projection:A.default,resolutions:B,extent:r,center:[2532661,1151654],zoom:10}),o=function(e,t="image/jpeg"){const n=new U({layer:e,format:t,timestamp:"current",projection:A.default,crossOrigin:"anonymous"});return new(0,$.default)({source:n})}("ch.swisstopo.pixelkarte-farbe"),s=N(),a=new(0,X.default)({target:e,view:i,layers:[o,s,n]});return window.mymap=a,{map:a,trackLayer:n,shadowTrackLayer:s}}var Q=r("2o3CH"),Z=r("l7vEP"),ee=r("dIG9p"),te=r("3xcD3"),ne=r("9vPkX"),re=r("k3TIJ"),ie=r("9XCu7");const oe="EPSG:21781",se=`\n  +proj=${re.default}\n  +lat_0=46.95240555555556\n  +lon_0=7.439583333333333\n  +k_0=1\n  +x_0=600000\n  +y_0=200000\n  +ellps=bessel\n  +towgs84=674.374,15.056,405.346,0,0,0,0\n  +units=m\n  +no_defs\n`,ae=(0,ie.create)(oe,se,[42e4,3e4,9e5,35e4]);const le=new(0,Z.default);function ce(e,t){return e.findIndex((e=>(0,Q.equals)(e,t)))}async function ue(e,t){const n=await fetch(`https://map.veloland.ch/api/4/tracks/${e}`),r=le.readFeature(await n.json()),i=JSON.parse(r.get("via_points"));console.assert(i.length>=2);const o=r.getGeometry().getCoordinates(),s=i.map(((e,n)=>new(0,ee.default)({geometry:new(0,ne.default)(e).transform(ae,t),type:"controlPoint",snapped:!0,index:n})));s.at(0).set("subtype","first"),s.at(-1).set("subtype","last");for(let e=0;e<i.length-1;e++){const n=ce(o,i[e]),r=ce(o,i[e+1]);s.push(new(0,ee.default)({geometry:new(0,te.default)(o.slice(n,r)).transform(ae,t),type:"segment",snapped:!0}))}return s}async function de(e,t){const n=await fetch(`https://map.veloland.ch/api/4/tracks/${e}/pois`);return le.readFeatures(await n.json()).map((e=>(e.getGeometry().transform(ae,t),e.set("type","POI"),e)))}var fe=r("kqI9g");!async function(){const{map:e,trackLayer:t,shadowTrackLayer:n}=Y("map"),r=e.getView().getProjection(),c=new(0,o.default)({url:"https://graphhopper-all.schweizmobil.ch/route?vehicle=schmwander&type=json&weighting=fastest&elevation=true&way_point_max_distance=0&instructions=false&points_encoded=true",mapProjection:r}),u=new(0,s.FallbackProfiler)({profilers:[new(0,s.ExtractFromSegmentProfiler),new(0,s.SwisstopoProfiler)({projection:r})]}),d=new(0,i.default)({map:e,router:c,profiler:u,trackLayer:t,shadowTrackLayer:n,style:P,deleteCondition:function(e,t){return(0,fe.click)(e)&&"POI"!==t}}),p=new URLSearchParams(document.location.search).get("trackId");p&&(d.restoreFeatures([...await ue(p,r),...await de(p,r)]),e.getView().fit(t.getSource().getExtent(),{padding:[50,50,50,50]}));const g=new(0,a.default)({map:e,profileTarget:"#profile"});d.addTrackChangeEventListener((()=>{const e=d.getSegments();g.refreshProfile(e)})),d.addTrackHoverEventListener((e=>{void 0!==e?g.highlight(e):g.clearHighlight()})),d.mode="edit",document.querySelector("#trackmode").addEventListener("change",(e=>d.mode=e.target.value)),document.querySelector("#snap").addEventListener("click",(()=>{d.snapping=!d.snapping})),document.querySelector("#delete").addEventListener("click",(()=>{d.deleteLastPoint()})),document.querySelector("#clear").addEventListener("click",(()=>{d.clear()})),document.querySelector("#undo").addEventListener("click",(()=>d.undo())),document.querySelector("#redo").addEventListener("click",(()=>d.redo())),document.querySelector("#getTrackData").addEventListener("click",(()=>{d.getTrackFeature();const e=[...d.getControlPoints(),...d.getSegments()];d.restoreFeatures(e)})),document.querySelector("#reverse").addEventListener("click",(()=>{d.reverse()})),g.setTrackHoverStyle(new(0,f.default)({image:new(0,j.default)({fill:new(0,l.default)({color:"blue"}),radius:9})}))}();
//# sourceMappingURL=schm.69a6e004.js.map
